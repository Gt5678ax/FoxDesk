# FoxDesk — Apache Configuration
# Security headers are set via PHP (includes/security-helpers.php).

# ── Disable directory listing ────────────────────────────────────────────────
Options -Indexes

# ── Pass Authorization header to PHP (API Bearer token auth) ─────────────────
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{HTTP:Authorization} .+
  RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</IfModule>

# Fallback for CGI/FastCGI setups
SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

# ── Block direct access to sensitive files ───────────────────────────────────
<FilesMatch "^(config\.php|config\.example\.php|docker-setup\.php|version\.json|\.maintenance)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order deny,allow
    Deny from all
  </IfModule>
</FilesMatch>

# ── Block direct access to internal directories ─────────────────────────────
<IfModule mod_rewrite.c>
  # Block includes/, bin/, backups/ from direct web access
  RewriteRule ^(includes|bin|backups)/ - [F,L]
</IfModule>

# ── Block SQL and log files ──────────────────────────────────────────────────
<FilesMatch "\.(sql|log|sh|env)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order deny,allow
    Deny from all
  </IfModule>
</FilesMatch>
